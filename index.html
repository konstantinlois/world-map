<!DOCTYPE html>
<html>
<head>

	<title>Quick Start - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <script src="./leaflet-event-forwarder.js"></script>

    <script src="states_provinces.json"></script>
    <script src="countries.json"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
						background: #9999FF;
        }
				#countries {
					position:absolute;
				  top:100px;
					left: 10px;
					z-index: 1000;
				}
				#next-button {
				  position:absolute;
				  top:140px;
					left: 10px;
					z-index: 1000;
				}
				#state-name {
					position:absolute;
				  top:170px;
					left: 10px;
					z-index: 1000;
				}
				#check-state-name-button {
				  position:absolute;
				  top:200px;
					left: 10px;
					z-index: 1000;
				}
    </style>

</head>
<body>



<div id="map" style="width: 100%; height: 100%;"></div>

<select name="countries" id="countries" onchange="countrySelected()">
</select>

<button id="next-button" onclick="next();">Next</button>

<form onsubmit="checkStateName(event);">
	<input id="state-name" type="text">
	<button id="check-state-name-button" type="submit">Check</button>
</form>

<script type="text/javascript">

	function checkStateName(event) {
			event.preventDefault();
			console.log(lastState.feature.properties.name);
			console.log(document.getElementById("state-name").value);
			if(lastState.feature.properties.name == document.getElementById("state-name").value){
				alert('correct');
				document.getElementById("state-name").value = "";
				next();
			}else{
				alert('wrong');
			}
	}

	var lastState;

	function next(){
		if(lastState != undefined){
			resetHighlight(lastState);
		}

		//console.log(states.features);
		/*const values = Object.values(geojson._layers)

		valuesFiltered = values.filter(function (a) {
			var selectBox = document.getElementById("countries");
	    var selectedValue = selectBox.options[selectBox.selectedIndex].value;
    	return a.feature.properties.geonunit === selectedValue;
		});*/

		var values = [];

		layerGroup.eachLayer(function (layer) {
			layer.eachLayer(function(layer2) {
  			values.push(layer2);
			});
		});

		if(values.length > 0){
			var randomValue = lastState;
			do{
				randomValue = values[parseInt(Math.random() * values.length)]
			}while(values.length > 1 && randomValue == lastState)

			console.log(randomValue);

			lastState = randomValue;

			highlightFeature(randomValue);
		}
	}

	var map = L.map('map').setView([37.8, -96], 4);

	/*L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/light-v9',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);*/

	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = '<h4>Info</h4>' +  (props ?
			'<b>' + props.name + '</b><br />' + props.geonunit
			: 'Hover over a state');
	};

	info.addTo(map);

	// Countries

	function styleCountry(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: '#003839',
			//dashArray: '3',
			fillOpacity: 1.0,
			fillColor: '#6abf69'
		};
	}

	function highlightFeatureCountries(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 4,
			color: '#222222',
			dashArray: '',
			fillOpacity: 1.0
		});

		/*if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}*/

		//info.update(layer.feature.properties);
	}

	function resetHighlightCountries(e) {
		geojson2.resetStyle(e.target);
		//info.update();
	}

	function zoomToFeatureCountries(e) {
		map.fitBounds(e.target.getBounds(), {padding: [1000, 1000]});
	}

	function onEachFeatureCountries(feature, layer) {
		layer.on({
			//mouseover: highlightFeatureCountries,
			//mouseout: resetHighlightCountries,
			//click: zoomToFeature
		});
	}

	var geojson2;
	geojson2 = L.geoJson(countries, {
    style: styleCountry,
    onEachFeature: onEachFeatureCountries
  }).addTo(map);

	// States and Provinces

	function style(feature) {
		return {
			weight: 1,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			//fillOpacity: 1,
			//fillColor: '#6abf69'
		};
	}

	function highlightFeature(layer) {
    //layer = e.target;
		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: ''
		});

		/*if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}*/

		info.update(layer.feature.properties);
	}

  function resetHighlight(layer) {
		//geojson.resetStyle(e.target);
		//geojson.resetStyle(layer);
		//info.update();

		layerGroup.eachLayer(function (l) {
    	l.resetStyle(layer);
		});
	}

	function zoomToFeature(layer) {
		//map.fitBounds(e.target.getBounds());

		map.fitBounds(layer.getBounds(), {padding: [300, 300]});
	}

	function onEachFeature(feature, layer) {
		/*layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: updateInfo
		});*/
	}

	/*var geojson;
	geojson = L.geoJson(states, {
		//style: style,
		//onEachFeature: onEachFeature
	});*/

	/*var layersControl = L.control.layers().addTo(map);

	var categories = new Set();

	for (var i in states[0].features) {
		var feature = states[0].features[i];
		categories.add(feature.properties.geonunit);
	}

	categories.forEach(function(category) {
      var layer = L.geoJSON(states[0].features, {
				style: style,
        filter: function(f){ return f.properties.geonunit === category }

			}).addTo(map);
      layersControl.addOverlay(layer, category);
  });*/

	var x = document.getElementById("countries");

	var categories = new Set();

	for (var i in states[0].features) {
		var feature = states[0].features[i];

		if(!categories.has(feature.properties.geonunit)){
			var opt = document.createElement('option');
			opt.value = feature.properties.geonunit;
			opt.innerHTML = feature.properties.geonunit;
			x.add(opt);

			categories.add(feature.properties.geonunit);
		}
	}

	var layerGroup = L.featureGroup([]).addTo(map);

	function countrySelected(){
		layerGroup.eachLayer(function(layer) { layerGroup.removeLayer(layer);});

		var selectBox = document.getElementById("countries");
    var selectedValue = selectBox.options[selectBox.selectedIndex].value;

		var layer = L.geoJSON(states[0].features, {
			style: style,
			filter: function(f){ return f.properties.geonunit === selectedValue }

		});

		layerGroup.addLayer(layer);

		map.fitBounds(layerGroup.getBounds());

		next();
	}

	// General
	function updateInfo(e){
		layer = e.target;
		info.update(layer.feature.properties);
		highlightFeature(e);
	}

	const myEventForwarder = new L.eventForwarder({
	  // ref to leaflet map
	  map: map,
	  // events to forward
	  events: {
	    click: true,
	    mousemove: true,
	    mouseout: true
	  },
	  // throttle options for mousemove events (same as underscore.js)
	  throttleMs: 100,
	  throttleOptions: {
	    leading: true,
	    trailing: false
	  }
	});

	// enable event forwarding
	myEventForwarder.enable();

	window.toggle = false;

	function togglePoints() {
	  if(!toggle) {
	    map.removeLayer(geojson);
	  } else {
	    map.addLayer(geojson);
	  }
	  toggle = !toggle;
	}

	map.attributionControl.addAttribution('Population data &copy; <a href="http://census.gov/">US Census Bureau</a>');

</script>



</body>
</html>
